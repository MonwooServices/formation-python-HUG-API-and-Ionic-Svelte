<html>

<body>
  <div class="results"></div>
<!-- TEST OK -->
<!-- TP -->
  <SCRIPT>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const backendIp = urlParams.get("backendIp") || "192.168.1.100";
    const backendPort = urlParams.get("backendPort") || "8000";

    const board = document.querySelector('.results');
    const appendToBody = (html) => {
      const placeholder = document.createElement("div");
      placeholder.innerHTML = html;
      board.append(placeholder);
    }

    // FAILING home page
    appendToBody(`
        <strong>TEST 1</strong> : home page errors validation in progress...
    `);

    fetch(`http://${backendIp}:${backendPort}`).then(
      async resp => {
        const dataResp = await resp.json(); // this returns a promise
        console.assert(
          // !resp.ok && dataResp.404, TIPS : syntax error since JS variables and attributs can't start by numbers
          !resp.ok && dataResp["404"],
          "[TEST-ERROR] Should do 404 page"
        );
        if (resp.ok) {
          appendToBody(`
            <strong>ERROR</strong> : TEST FAIL, home should not be accessible
          `);
        }
        return resp;
      }).then(repos => {
      console.log(repos)
    }).catch(ex => {
      console.error(ex);
    })

    appendToBody(`
        <strong>TEST 1</strong> : DONE
    `);

    // text messages history
    appendToBody(`
        <strong>TEST 2</strong> : text messages history
    `);

    fetch(`http://${backendIp}:${backendPort}/api?msg=log&date=2023-07-21`
      // Missing JWT token headers...
    ).then(
      async resp => {
        const dataResp = await resp.json(); // this returns a promise

        // TODO : OK if OPEN (should FAIL if need JWT TOKEN header)
        console.assert(
          // !resp.ok && dataResp.404, TIPS : syntax error since JS variables and attributs can't start by numbers
          resp.ok && (dataResp.msg == "log"),
          "[TEST-ERROR] Should do 404 page"
        );
        return resp;
      }).then(repos => {
      console.log(repos)
    }).catch(ex => {
      console.error(ex);
    })

    appendToBody(`
        <strong>TEST 2</strong> : DONE
    `);

    appendToBody(`
        <strong>TEST 3</strong> : text writing history
    `);

    // fetch(`http://${backendIp}:${backendPort}/api/jwt/login`, {
    fetch(`http://${backendIp}:${backendPort}/api/buddy/message`, {
      method: "POST",
      // headers: { // POUR les call qui sont DEJA authentifiÃ©
      //   ... : ... token(encoded) // Pas besoin pour le login...
      // }
      data: {
        username: 'hello', // TODO, (NEW ? UPDATE ? )
        password: 'world', // TODO, (NEW ? UPDATE ? )
      }
    }).then(
      async resp => {
        const dataResp = await resp.json(); // this returns a promise
        // TODO
        return resp;
      }).then(repos => {
      console.log(repos)
    }).catch(ex => {
      console.error(ex);
    })

    appendToBody(`
        <strong>TEST 3</strong> : DONE
    `);
  </SCRIPT>

</html>